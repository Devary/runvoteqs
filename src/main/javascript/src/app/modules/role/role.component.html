<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <p-button label="New" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
    <p-button severity="secondary" label="Delete selected ({{!selectedRoles?0:selectedRoles.length}})" icon="pi pi-trash" outlined (onClick)="deleteSelectedSharacters()" [disabled]="!selectedRoles || !selectedRoles.length" />
  </ng-template>

  <ng-template #end>
    <p-button label="Export" icon="pi pi-upload" severity="secondary" (onClick)="exportCSV()" />
    <fa-icon [icon]="faCoffee"></fa-icon>
  </ng-template>
</p-toolbar>
<p-table
  #dt
  [value]="roles()"
  (onLazyLoad)="roles()"
  (change)="roles()"
  [paginator]="true"
  [rows]="tablePageSize"
  dataKey="id"
  [tableStyle]="{ 'min-width': '50rem' }"
  [rowsPerPageOptions]="[5, 10, 20]"
  [showCurrentPageReport]="true"
  [loading]="loading"
  [rowHover]="true"
  [globalFilterFields]="['name','description','role']"
  [(selection)]="selectedRoles"
  [contextMenu]="true"
  contextMenuSelectionMode="separate"
  selectionMode="multiple"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
>

  <ng-template pTemplate="header">
    <tr>
      <th>
        <div class="flex justify-content-center align-items-center">
        Name
        </div>
      </th>
      <th>Description</th>
      <th>Action</th>
    </tr>
    <tr>
      <th>
        <p-columnFilter
          type="text"
          field="name"
          placeholder="Search by name"
          ariaLabel="Filter Name"
        ></p-columnFilter>
      </th>
      <th>
        <p-columnFilter
          type="text"
          field="description"
          placeholder="Search by description"
          ariaLabel="Filter description"
          [ngStyle]="{width:'100%'}"
        ></p-columnFilter>
      </th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-role let-rowIndex="rowIndex">

    <tr [pSelectableRow]="role" [pSelectableRowIndex]="rowIndex" >
      <td>{{ role.name }}</td>
      <td [innerHTML]="role.description"></td>
      <td><p-button icon="pi pi-trash" severity="danger" (onClick)="delete(role)" /><p-button icon="pi pi-pencil" severity="info" (onClick)="edit(role)" /></td>
    </tr>
  </ng-template>
  <ng-template #emptymessage>
    <tr>
      <td colspan="5" class="text-center">No role found.</td>
    </tr>
  </ng-template>
</p-table>


<p-dialog [(visible)]="createRoleDialog" [style]="{ width: '650px',height:'100%' }" header="Role Details" [modal]="true" (onHide)="hideDialog()">
  <ng-template #content>

    <div class="flex flex-col gap-6">
        <div>
          <label for="name" class="block font-bold mb-3">Name*</label>
          <input type="text" id="name" pInputText [(ngModel)]="role.name"  autofocus fluid />
          <small class="text-gray-500">Name must contains at least 4 characters.</small>
        </div>
        <div>
          <label for="description" class="block font-bold mb-3">Description*</label>
          <p-editor id="description" [(ngModel)]="role.description"  required fluid minlength="50">
            <ng-template #header>
        <span class="ql-formats">
            <button type="button" class="ql-bold" aria-label="Bold"></button>
            <button type="button" class="ql-italic" aria-label="Italic"></button>
            <button type="button" class="ql-underline" aria-label="Underline"></button>
        </span>
            </ng-template>
          </p-editor>
        </div>
      <div>
        <label for="tag" class="block font-bold mb-3">Tag*</label>
        <input type="text" id="tag" pInputText [(ngModel)]="role.name"  autofocus fluid />
        <p-colorpicker [ngModel]='role.meta.get("classBgColor")'></p-colorpicker>
      </div>
      </div>
  </ng-template>

    <ng-template #footer>
      <p-button label="Cancel" icon="pi pi-times" text (click)="hideDialog()" />
      <p-button label="Save" icon="pi pi-plus" text (onClick)="processEntity()" />
    </ng-template>
</p-dialog>

<p-toast />
<p-confirm-dialog [style]="{ width: '450px' }" label="Delete"/>
